<link rel="import" href="../../bower_components/polymer/polymer.html">

<script src="../../bower_components/jquery/dist/jquery.js"></script>
<script src="../../bower_components/highcharts/highcharts.js"></script>
<script src="../../bower_components/highcharts/highstock.js"></script>
<script src="../../bower_components/highcharts/highmaps.js"></script>
<script src="../../bower_components/highcharts/modules/exporting.js"></script>

<dom-module id="stacked-bar-chart">
  <template>
   
    <div id="containerStack" style="width:100%; height:300px;"></div>
  </template>

  <script>
    Polymer({

      is: 'stacked-bar-chart',

      properties: {
        prop1: {
          type: String,
          value: 'sample-app-app',
        },
      },
      ready: function() {
	
	/*var data = [
{"PurchasingRequisitionSource":"source", "AgeClassification":"Aging (+5 days)", "val":5741},
{"PurchasingRequisitionSource":"source", "AgeClassification":"Ok", "val":10819},
{"PurchasingRequisitionSource":"No source", "AgeClassification":"Aging (+5 days)", "val":777},
{"PurchasingRequisitionSource":"No source", "AgeClassification":"Ok", "val":1306}
];
	//$.getJSON('https://predixpurchasereqsourcems-mm.run.aws-usw02-pr.ice.predix.io/purReqSource', function(data1) {
		//data = data1;
	var seriesData = [];
	var xCategories = [];
	var i, cat;
	for(i = 0; i < data.length; i++){
	     cat = data[i].PurchasingRequisitionSource;
	     if(xCategories.indexOf(cat) === -1){
		xCategories[xCategories.length] = cat;
	     }
	}
	for(i = 0; i < data.length; i++){
	    if(seriesData){
	      var currSeries = seriesData.filter(function(seriesObject){ return seriesObject.name == data[i].AgeClassification;});
	      if(currSeries.length === 0){
		  currSeries = seriesData[seriesData.length] = {name: data[i].AgeClassification, data: []};
	      } else {
		  currSeries = currSeries[0];
	      }
	      var index = currSeries.data.length;
	      currSeries.data[index] = data[i].val;
	    } else {
	       seriesData[0] = {name: data[i].AgeClassification, data: [data[i].val]}
	    }
	}
	var options = {
		chart: {
			renderTo: 'container',
			type: 'bar'
		},
		plotOptions: {
			column: {
				stacking: 'normal'
			}
		},
		legend: {
		    reversed: true
		},
		plotOptions: {
		    series: {
			stacking: 'normal'
		    }
		},
		xAxis:{ categories: xCategories},
		series: seriesData
	    };
	options.series[0].data = seriesData;
	alert(seriesData);
	var chart = new Highcharts.Chart(options);

	});*/
	
	

	/*var chart = new Highcharts.Chart({
		chart: {
			renderTo: 'container',
			type: 'bar'
		},
		plotOptions: {
			column: {
				stacking: 'normal'
			}
		},
		legend: {
		    reversed: true
		},
		plotOptions: {
		    series: {
			stacking: 'normal'
		    }
		},
		xAxis:{ categories: xCategories},
		series: seriesData
	});*/
	    //});
    /*var chart;

        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'containerStack',
                type: 'bar'
            },
            title: {
                text: 'Stacked column chart'
            },
            xAxis: {
                categories: xCategories
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'Stacked Bar Chart'
                },
                stackLabels: {
                    enabled: true,
                    style: {
                        fontWeight: 'bold',
                        color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
                    }
                }
            },
            legend: {
		    reversed: true
		},
		plotOptions: {
		    series: {
			stacking: 'normal'
		    }
		},
            series: seriesData
        });*/
        
        
/***************        
        
var optionsStack;
$.getJSON('../../sample-data/stacked-bar-data.json', function(data1) {
//$.getJSON('https://predixpurchasereqsourcems-mm.run.aws-usw02-pr.ice.predix.io/purReqSource', function(data1) {
		//optionsStack.series[0].data = testData;
		
		
		
		optionsStack = {
		chart: {
                renderTo: 'containerStack',
                type: 'bar'
            },
            title: {
                text: 'Stacked column chart'
            },
            xAxis: {
                categories: ['source', 'no source']
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'Stacked Bar Chart'
                },
                stackLabels: {
                    enabled: true,
                    style: {
                        fontWeight: 'bold',
                        color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
                    }
                }
            },
            legend: {
		    reversed: true
		},
		plotOptions: {
		    series: {
			stacking: 'normal'
		    }
		},
            series: data1
            //series: [{}]
	    };

			var chartStack = new Highcharts.Chart(optionsStack);
	   });
/*
	$.getJSON('../../sample-data/stacked-bar-data.json', function(data1) {
	//$.getJSON('https://predixpurchasereqsourcems-mm.run.aws-usw02-pr.ice.predix.io/purReqSource', function(data1) {

		alert("Stack..");
		
		optionsStack.series[0].data = data1;
		var chartStack = new Highcharts.Chart(optionsStack);
	    });
*
******************/

			refreshStackedChart('ALL');
      }
     });
    
    
	function refreshStackedChart(plantID)
	{
		var optionsStack;
		
		var urlStatic = '../../sample-data/stacked-bar-data.json';
		var urlStack = 'https://predixpurchasereqsourcems-mm.run.aws-usw02-pr.ice.predix.io/purReqSource';
		
		/*
		Uncomment when drill down is ready
		if(plantID != 'ALL')
			{
				urlStack += "/"+plantID;
			}
		*/
		
//$.getJSON(urlStatic, function(data1) {
$.getJSON(urlStack, function(data1) {
		//optionsStack.series[0].data = testData;
		
		
		
		optionsStack = {
		chart: {
                renderTo: 'containerStack',
                type: 'bar'
            },legend: {
			 enabled: false		
		},
		credits: {
      enabled: false
  },
		exporting: {
        buttons: {
            contextButtons: {
                enabled: false,
                menuItems: null
            }
        },
        	enabled: false
        },
            title: {
                text: 'Stacked column chart'
            },
            xAxis: {
                categories: ['source', 'no source']
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'Stacked Bar Chart'
                },
                stackLabels: {
                    enabled: true,
                    style: {
                        fontWeight: 'bold',
                        color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
                    }
                }
            },
            legend: {
		    reversed: true
		},
		plotOptions: {
		    series: {
			stacking: 'normal'
		    }
		},
            series: data1
            //series: [{}]
	    };

			var chartStack = new Highcharts.Chart(optionsStack);
	   });
	}    
    
  </script>
</dom-module>
